vagrant@ubuntu-focal:~/golang/src/httpserver$ k create -f httpserver-deploy.yaml
deployment.apps/httpserver created

vagrant@ubuntu-focal:~/golang/src/httpserver$ k get pods
NAME                          READY   STATUS    RESTARTS   AGE
httpserver-5bd5466bff-58vxm   1/1     Running   0          24s
httpserver-5bd5466bff-dnxtm   1/1     Running   0          24s
httpserver-5bd5466bff-tw666   1/1     Running   0          24s


vagrant@ubuntu-focal:~/golang/src/httpserver$ vi httpserver-service.yaml
vagrant@ubuntu-focal:~/golang/src/httpserver$ k create -f httpserver-service.yaml
service/httpserver-service created

vagrant@ubuntu-focal:~/golang/src/httpserver$ k get svc
NAME                 TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE
httpserver-service   NodePort    10.96.17.65   <none>        80:30046/TCP   5s
kubernetes           ClusterIP   10.96.0.1     <none>        443/TCP        61d
vagrant@ubuntu-focal:~/golang/src/httpserver$ k get ep
NAME                 ENDPOINTS                                                  AGE
httpserver-service   192.168.223.188:80,192.168.223.189:80,192.168.223.190:80   70s
kubernetes           192.168.34.2:6443                                          61d

vagrant@ubuntu-focal:~/git/geektime/cncamp/101/module8/ingress$ kubectl create -f nginx-ingress-deployment.yaml
namespace/ingress-nginx created
serviceaccount/ingress-nginx created
configmap/ingress-nginx-controller created
clusterrole.rbac.authorization.k8s.io/ingress-nginx created
clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created
role.rbac.authorization.k8s.io/ingress-nginx created
rolebinding.rbac.authorization.k8s.io/ingress-nginx created
service/ingress-nginx-controller-admission created
service/ingress-nginx-controller created
deployment.apps/ingress-nginx-controller created
ingressclass.networking.k8s.io/nginx created
validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created
serviceaccount/ingress-nginx-admission created
clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created
clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
role.rbac.authorization.k8s.io/ingress-nginx-admission created
rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
job.batch/ingress-nginx-admission-create created
job.batch/ingress-nginx-admission-patch created

vagrant@ubuntu-focal:~/golang/src/httpserver$ openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/CN=*/O=cncamp"
Generating a RSA private key
.....................+++++
...+++++
writing new private key to 'tls.key'
-----

vagrant@ubuntu-focal:~/golang/src/httpserver$ cat tls.crt | base64 -w 0
LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURHekNDQWdPZ0F3SUJBZ0lVQnZKMVg3SWttM1Q3bDByODV6YnVmU0huMzlVd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0hURUtNQWdHQTFVRUF3d0JLakVQTUEwR0ExVUVDZ3dHWTI1allXMXdNQjRYRFRJeE1USXhNakE0TWpFdwpObG9YRFRJeU1USXhNakE0TWpFd05sb3dIVEVLTUFnR0ExVUVBd3dCS2pFUE1BMEdBMVVFQ2d3R1kyNWpZVzF3Ck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBczBOQ3FDZHp5Z0MzVjhkVGNSSUoKczRBWVRWYkdhL283T013dXV3Tk9DUzhlYlBKLzQyZnlRcHJMWEdmUWxmK09ZbXlBeGpNbkNucnlKcnpzUElvcwpzTHMwR2dEVEdRME15L3ByWHdlNXc4M0ZSVlRzcm5TVGYzQnJ2ZkdBdHY5VEZlOTVrNzVDaEVJa3VvMEg0TFU3CjZPeTNJeXduOHAzTzRZTm9EbkpScTUvV3grTEtaamN1aWs2Ymp3NVpBcWxiM3hFR282NjlaNndNZHdiVnN5eUcKdGhwcGllVEdYRDFpck9yOUpWeDFqcXBZdzduTmg5SWNCYnZoMWZBMkhBS1ZUSXM5Nyt1S0xhMkZXVTB6WlN1eApOSHVaZXpnVmJyWklqY3FnSUJEanhjUzBDYXM2V3FCekN1c0NBc2tsZi9HUVA0ckl0RDNPcFQ2b0liMVMwZkN2ClF3SURBUUFCbzFNd1VUQWRCZ05WSFE0RUZnUVVCUTF6czYvZnkvekxRNk85QWQ5a1ZEeW5YWHN3SHdZRFZSMGoKQkJnd0ZvQVVCUTF6czYvZnkvekxRNk85QWQ5a1ZEeW5YWHN3RHdZRFZSMFRBUUgvQkFVd0F3RUIvekFOQmdrcQpoa2lHOXcwQkFRc0ZBQU9DQVFFQWxpK3NwYTRZNm5tWHBLQVlIR0ZTQUgraWJjaUdmS2Z4UDQyRk9PdjN6VEFrClZ5VHBkcXFJcWpRSmsxcDd2R0RiUXF4b3ZYTFNzcXV2d0creEl2ZHlzeVc2U2hnazV0L2xUUWNkaWRlaDQzc24KTk5uSjYzVkVDL0F0NVBzb3VUcERsd1oyNEI4UmdTTlZHWitLNG43NXZzQlMvQ0s4MU53Q1Jxd01UN05WN2xGdQpVak5Yb3V2REYzRFFxSXUvRGVtc01FWTlsRGE4YmVISHFoRklKdjcrQnJJVEdtOFkvM1JlRWYrWjZtTHI0cEduCmpJaU5VUXJVQUNBTXlzaWwxRWxkbGwxK0dIbExXT3IvcHpGc2lFTnhCOGtZeUZaMnJPK1BSUExLSHFRK3h4cUoKcy9CYXIyR3JwdzE0SFNEa0pKMjNUNmNvUUpIYWJJVFgxRkhkdEh3c3N3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=vagrant@ubuntu-focal:~/golang/src/httpserver$ vi secret.yaml
vagrant@ubuntu-focal:~/golang/src/httpserver$ vi secret.yaml
vagrant@ubuntu-focal:~/golang/src/httpserver$ cat tls.key | base64 -w 0
LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQ3pRMEtvSjNQS0FMZFgKeDFOeEVnbXpnQmhOVnNacitqczR6QzY3QTA0Skx4NXM4bi9qWi9KQ21zdGNaOUNWLzQ1aWJJREdNeWNLZXZJbQp2T3c4aWl5d3V6UWFBTk1aRFF6TCttdGZCN25EemNWRlZPeXVkSk4vY0d1OThZQzIvMU1WNzNtVHZrS0VRaVM2CmpRZmd0VHZvN0xjakxDZnluYzdoZzJnT2NsR3JuOWJINHNwbU55NktUcHVQRGxrQ3FWdmZFUWFqcnIxbnJBeDMKQnRXekxJYTJHbW1KNU1aY1BXS3M2djBsWEhXT3FsakR1YzJIMGh3RnUrSFY4RFljQXBWTWl6M3Y2NG90cllWWgpUVE5sSzdFMGU1bDdPQlZ1dGtpTnlxQWdFT1BGeExRSnF6cGFvSE1LNndJQ3lTVi84WkEvaXNpMFBjNmxQcWdoCnZWTFI4SzlEQWdNQkFBRUNnZ0VBUnNvUTBJYUQyd2xkWFhTQkp1MlFseW5HYndRTlp5WnhySVExRC9UR0pDcFAKUVlhaHFoT3FQMU1SYTNRemtvaFFtZDF2SE5XbVhTVWY2dHhBRGNnaXpjZWZVNFZ2MXp5b0NRVGkwYXdqVjRjeQpsNlpwc0pxb2hITEltVUY5S3NhNDhMaVlzaGMzL1RLQmZvbWl5c0hHM3J4YnRiQUNOblRLOVpNR3pHMm9nclQ2Cnk5MEVlNnNUVnRJQ1V3cU1Ra0VXU0w4VTdhMkRlU212OFhZdHdoM1BjWWhHajNneFplVkptcFA4UDdnaUpjVzkKSzFEMG12cnRacWVSdXFPTm0wd2o4M29Ra3Z1cVljS0Jibkk1VDFZajFNVm9CM3VRdFVYM1JZQ2NqYTZ1QWQyTgovV1ZkbW1aVWFtVkM4cit6YTNZWSs3ZFYvZGdUTTVNVnNhRUh0WXEvUVFLQmdRRGFIM281ME94U2kxb2tqWGtnCkYwZ3RhUy82WVZnU0F5ZkdvWDkxK05ML1ZCUUV3WmRNazJjZGRNWThTWGV6NWJHNDNBUkJLOTNkTm8wSllmcnYKQXJEY2JpZXgwQ2xVak5sUEUwU2JGaFhSZ04wME1uYkpDb0FhOG1YS2FxZHNoUC9ZSHdITkd1dnRFUUkzVDhYUgpJcTM4YmJyUVBwQ2ZuN1BLcERXMnpLRTVkUUtCZ1FEU1pFYUlsWFIrY0xLSTF6S2dza1ZTSWNrRGxoNG45cUNEClNsbVFFMys4UUZFRVBhdmY0d3NqSFJwNk8vK2t5L01pbi9Qb01nUjIwaVFVVmY0M3JkWmI0N1hpNG5kMEZ6NnkKQjh3M3Y5dUZPTjV5YzRnQXowc3Uxcjd5Mk5VTlhaNHA2Zjdjd0dzRTVwVjlUaitsNjdEbHRMQVAvWkhLOWFkRApEV2lubHFmMjF3S0JnUUNHWFV1YW4vTmo2Y25PcUlPTDNDdXZKWlBUaGZHTnJ2bnFwd053ZGFYc2VTdVh2blZvClM0a0NvVE9ZWVoxbWFVRXdZZ0FROFdmTFpGWS9DR2Rlb21hMmN2anExUk1Rclc4VUFnZUtEWEhGUzc5Mzd2b3oKWDgrSVNmZWdXRkRvVFltWTVZampnd2tBVVREdlI2blE2YThKeDhLRGszYmRqYkJnVFFWMXBOcFFIUUtCZ1FDMwpNT2paZElrQ3IwNUZLRnZFNEhUTGx1OVlXQlhaNWp6TkZLZjNjNEw5ZjJNTHRrYzVvby9IKzBkYXQzTlpJdHlKCmdZejIyTlphUDQ5NnhZV2RKWmhJV25XOUlFT3lxYXJGaVZTZ0ZrWW1NZVkrOGFteVNzekQ4K2cvdTkyR3pjVXgKNmJVb3NjSjllZWtnT2tuaFJ0KzRveVBLU0pmeGlRUWl0a0l4NmxSRjhRS0JnQTJISU1IbmRVMjBoTm5wSW1ZdgpPRG54TEdmcGwyaVd1MWlOMnVkL3pEaGozRW9LUFVqSDhqYmRRa0Q2NVRyVzNkQTJZbDgxY0tNUitOWkgvM1BzCmJNTjlYTlFLVnJ0ZmpVTGxteE00aWtGNVpQTDdsK0xkaWlkN0tZVHhUNEZrT3FZU1Q0S3A0cUhWQVVLOWF3bEcKMnJlQXg3K3RXNTgrYmw1MnhTUThWNDNiCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0Kvagrant@ubuntu-focal:~/golang/src/httpserver$ vi secret.yaml

vagrant@ubuntu-focal:~/golang/src/httpserver$ k create -f secret.yaml
secret/cncamp-tls created

vagrant@ubuntu-focal:~/golang/src/httpserver$ k create -f ingress.yaml
ingress.networking.k8s.io/gateway created

vagrant@ubuntu-focal:~/golang/src/httpserver$ k get ep
NAME                 ENDPOINTS                                                  AGE
httpserver-service   192.168.223.188:80,192.168.223.189:80,192.168.223.190:80   19h
kubernetes           192.168.34.2:6443                                          62d

vagrant@ubuntu-focal:~/golang/src/httpserver$ vi ingress.yaml
vagrant@ubuntu-focal:~/golang/src/httpserver$ k create -f ingress.yaml
ingress.networking.k8s.io/gateway created


vagrant@ubuntu-focal:~/golang/src/httpserver$ k describe ingress
Warning: extensions/v1beta1 Ingress is deprecated in v1.14+, unavailable in v1.22+; use networking.k8s.io/v1 Ingress
Name:             gateway
Namespace:        default
Address:
Default backend:  default-http-backend:80 (<error: endpoints "default-http-backend" not found>)
TLS:
  cncamp-tls terminates cncamp.com
Rules:
  Host        Path  Backends
  ----        ----  --------
  cncamp.com
              /   httpserver-service:80 (192.168.223.188:80,192.168.223.189:80,192.168.223.190:80)
Annotations:  kubernetes.io/ingress.class: nginx
Events:
  Type    Reason  Age   From                      Message
  ----    ------  ----  ----                      -------
  Normal  Sync    7s    nginx-ingress-controller  Scheduled for sync

vagrant@ubuntu-focal:~/golang/src/httpserver$ k get svc
NAME                 TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE
httpserver-service   NodePort    10.96.17.65   <none>        80:30046/TCP   19h
kubernetes           ClusterIP   10.96.0.1     <none>        443/TCP        62d


vagrant@ubuntu-focal:~/golang/src/httpserver$ k get ingress
Warning: extensions/v1beta1 Ingress is deprecated in v1.14+, unavailable in v1.22+; use networking.k8s.io/v1 Ingress
NAME      CLASS    HOSTS        ADDRESS     PORTS     AGE
gateway   <none>   cncamp.com   10.0.2.15   80, 443   2m27s


vagrant@ubuntu-focal:~/golang/src/httpserver$ k get svc -n ingress-nginx
NAME                                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
ingress-nginx-controller             NodePort    10.108.142.73    <none>        80:30986/TCP,443:31563/TCP   103m
ingress-nginx-controller-admission   ClusterIP   10.104.163.255   <none>        443/TCP                      103m


vagrant@ubuntu-focal:~/golang/src/httpserver$ curl 10.0.2.15:30986
<html>
<head><title>404 Not Found</title></head>
<body>
<center><h1>404 Not Found</h1></center>
<hr><center>nginx</center>
</body>
</html>


vagrant@ubuntu-focal:~/golang/src/httpserver$ curl https://10.0.2.15:31563 -k
<html>
<head><title>404 Not Found</title></head>
<body>
<center><h1>404 Not Found</h1></center>
<hr><center>nginx</center>
</body>
</html>
